<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Location Logga - Oxnard to UCSB</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
</head>

<body>
  <main>
    <div class="container">
      <h1>Oxnard to UC</h1>

      <div class="section">
        <h2>Data Insights</h2>
        <ul>
          <li><span>Trip Peak Time: </span><span id="trip-peak-time-val"></span></li>
          <li><span>Average trip time: </span><span id="trip-avg-time-val"></span></li>
          <li><span>Suggested best times to leave in AM: </span><span id="best-times-to-leave-am"></span></li>
          <li><span>Suggested best times to leave in PM: </span><span id="best-times-to-leave-pm"></span></li>
          <li><span>Avoid traveling at: </span><span id="worst-times-to-leave"></span></li>

        </ul>
      </div>

      <div class="section">
        <h2>Trip Data for this Month</h2>
        <canvas id="monthlyDataChart" style="width:100%;max-width:1000px"></canvas>
      </div>
      <div class="divider"></div>

      <!-- <div class="section">
        <h2>Trip Data for this Month</h2>
        <canvas id="monthlyDataChart" style="width:100%;max-width:1000px"></canvas>
      </div> -->
      <!-- <div class="divider"></div> -->



    </div>
  </main>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
  <script>

    // fetch the data for monthly

    async function getDataFromBucket() {
      let uri = "https://storage.googleapis.com/location-logger-bucket/month-9_3_2022-550forestparkblvdoxnardca93036usa-6510elcolegiordgoletaca93117usa.json";
      const response = await fetch(uri);
      const data = await response.json();
      console.log("monthlyData", data);
      return data;
    }

    // TEMP
    // monthlyData = [
    //   {
    //     "timetodestminutes": 48,
    //     "hour": "13"
    //   },
    //   {
    //     "timetodestminutes": 55,
    //     "hour": "14"
    //   },
    //   {
    //     "timetodestminutes": 54,
    //     "hour": "15"
    //   },
    //   {
    //     "timetodestminutes": 47,
    //     "hour": "16"
    //   },
    //   {
    //     "timetodestminutes": 47,
    //     "hour": "17"
    //   },
    //   {
    //     "timetodestminutes": 47,
    //     "hour": "18"
    //   },
    //   {
    //     "timetodestminutes": 48,
    //     "hour": "19"
    //   },
    //   {
    //     "timetodestminutes": 48,
    //     "hour": "20"
    //   },
    //   {
    //     "timetodestminutes": 47,
    //     "hour": "21"
    //   },
    //   {
    //     "timetodestminutes": 48,
    //     "hour": "22"
    //   },
    //   {
    //     "timetodestminutes": 47,
    //     "hour": "23"
    //   },
    //   {
    //     "timetodestminutes": 47,
    //     "hour": "0"
    //   },
    //   {
    //     "timetodestminutes": 46,
    //     "hour": "1"
    //   },
    //   {
    //     "timetodestminutes": 46,
    //     "hour": "2"
    //   },
    //   {
    //     "timetodestminutes": 45,
    //     "hour": "3"
    //   }
    // ]


    function getInsights(data) {


      let insightsObj = {
        'trip-peak-time-val' : 1,
        "trip-avg-time-val": 1,
        "best-times-to-leave-am": [1,2,3],
        "best-times-to-leave-pm":[1,2,3],
        "worst-times-to-leave":[4,5,6]
      }

      // Trip peak time is the max of the set, sort the set by highest


      // Make a copy and modify this set to be UTC data
      let insightsData = data.map(({ hour, timetodestminutes }) =>
        ({ hour: adjustTimeForUTC(parseInt(hour)), timetodestminutes: timetodestminutes }))

      insightsData.sort((a, b) => b.timetodestminutes - a.timetodestminutes);
      var peakEntry = insightsData[0];
      console.log("Highest Trip Time observed: ", peakEntry);
      

      var worstTripTimes = [insightsData[0].hour, insightsData[1].hour, insightsData[2].hour]

      console.log("Avoid these times: ", worstTripTimes)

      // // Best trip times:

      let morningData = insightsData.filter((a) => a.hour < 12)
      morningData.sort((a, b) => a.timetodestminutes - b.timetodestminutes);

      var bestTripTimesAM = [morningData[0].hour, morningData[1].hour, morningData[2].hour];
      console.log("bestTripTimesInTheMorning: ", bestTripTimesAM);

      let afternoonData = insightsData.filter((a) => a.hour >= 12)
      afternoonData.sort((a, b) => a.timetodestminutes - b.timetodestminutes);

      var bestTripTimesPM = [afternoonData[0].hour, afternoonData[1].hour, afternoonData[2].hour];
      console.log("bestTripTimesInTheAfternoon: ", bestTripTimesPM);


    }

    function updateViewWithInsights(object) {

      var obj = {
        'trip-peak-time-val' : 1,
        "trip-avg-time-val": 1,
        "best-times-to-leave-am": [1,2,3],
        "best-times-to-leave-pm":[1,2,3],
        "worst-times-to-leave":[4,5,6]
      }


    }




    function drawChart(data) {

      var chartDataArr = data.map(function (entry) {
        var tObj = {}
        tObj.x = adjustTimeForUTC(parseInt(entry.hour));
        tObj.y = parseInt(entry.timetodestminutes);
        return tObj;
      })

      new Chart("monthlyDataChart", {
        type: "scatter",
        data: {
          datasets: [{
            pointRadius: 4,
            pointBackgroundColor: "rgb(0,0,255)",
            data: chartDataArr
          }]
        },
        options: {
          legend: { display: false },
          scales: {
            xAxes: [{ ticks: { min: 1, max: 24 } }],
            yAxes: [{ ticks: { min: 20, max: 90 } }],
          },
          title: {
            display: true,
            text: "Oxnard -> UCSB (Full month)"
          }
        }
      });

    }

    // Utility function to help
    function adjustTimeForUTC(originalUTCHr) {
      var utcDiff = -8;
      var tVal = originalUTCHr + utcDiff;
      return tVal < 0 ? tVal + 24 : tVal;
    }




    window.addEventListener('DOMContentLoaded', async (event) => {
      console.log('DOM fully loaded and parsed');

      let data = await getDataFromBucket();
      drawChart(data);
      getInsights(data);
    });



  </script>

</body>

<footer class="page-footer purple darken-4">
  <div class="container">
    <div class="row">
      <div class="col l6 s12">
        <h5 class="white-text">Thanks for hanging</h5>
        <p class="grey-text text-lighten-4">Did I really spend this much time on my footer?</p>
      </div>
      <div class="col l4 offset-l2 s12">
        <h5 class="white-text">Links</h5>
        <ul>
          <li><a class="grey-text text-lighten-3" href="https://jasonthechiu.com">site</a></li>
          <li><a class="grey-text text-lighten-3" href="https://medium.com/@foreza">blog</a></li>
          <li><a class="grey-text text-lighten-3" href="https://www.linkedin.com/in/jasonthechiu/">linkedin</a></li>
          <li><a class="grey-text text-lighten-3" href="https://www.buymeacoffee.com/foreza">coffee pls</a></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="footer-copyright">
    <div class="container">
      Â© 2022 Foreza
    </div>
  </div>
</footer>

</html>